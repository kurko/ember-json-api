/*! 
 * ember-json-api
 * Built on 2014-04-29
 * http://github.com/daliwali/ember-json-api
 * Copyright (c) 2014 Dali Zheng
 */
(function(){"use strict";var a=Ember.get,b=Ember.isNone;DS.JsonApiSerializer=DS.RESTSerializer.extend({extractSingle:function(a,b,c,d,e){var f=b.typeKey,g={};for(var h in c){var i=Ember.String.singularize(h);i===f&&Ember.isArray(c[h])?g[i]=c[h][0]:g[h]=c[h]}return this._super(a,b,g,d,e)},normalize:function(a,b,c){var d={};for(var e in b)if("links"!==e)d[e]=b[e];else if("object"==typeof b[e])for(var f in b[e])d[f]=b[e][f];return this._super(a,d,c)},normalizePayload:function(a,b){return b.meta&&(this.extractMeta(a,b.meta),delete b.meta),b.links&&(this.extractLinks(a,b.links),delete b.links),b.linked&&(this.extractLinked(b.linked),delete b.linked),b},extractLinked:function(b){var c,d,e,f=a(this,"store");for(c in b){if(d=b[c],d.links){for(e in d.links)d[e]=d.links.relation;delete d.links}console.log(d),f.pushMany(Ember.String.singularize(c),d)}},extractMeta:function(){},extractLinks:function(a,b){var c,d,e,f;for(c in b)d=c.split(".").pop(),e=b[c],"string"==typeof e?f=e:(d=e.type||d,f=e.href),"http"===f.substr(0,4).toLowerCase()&&(f=f.split("//").pop().split("/").slice(1).join("/")),"/"===f.charAt(0)&&(f=f.substr(1)),DS.set("_routes."+Ember.String.singularize(d),f)},serializeBelongsTo:function(c,d,e){var f=e.key,g=a(c,f);b(g)||(d.links=d.links||{},d.links[f]=a(g,"id"))},serializeHasMany:function(b,c,d){var e=d.key,f=DS.RelationshipChange.determineRelationshipType(b.constructor,d);("manyToNone"===f||"manyToMany"===f)&&(c.links=c.links||{},c.links[e]=a(b,e).mapBy("id"))}})}).call(this),function(){"use strict";var a=Ember.get;DS._routes={},DS.JsonApiAdapter=DS.RESTAdapter.extend({defaultSerializer:"DS/jsonApi",buildURL:function(b,c){var d=DS._routes[b];if(d){var e=[],f=a(this,"host"),g=this.urlPrefix(),h=new RegExp("{(.*?)}","g");return c?d.match(h)?e.push(d.replace(h,c)):e.push(d,c):e.push(d.replace(h,"")),g&&e.unshift(g),e=e.join("/"),!f&&e&&(e="/"+e),e}return this._super(b,c)},findMany:function(a,b,c){return this.ajax(this.buildURL(b.typeKey,c.join(",")),"GET")},createRecord:function(a,b,c){var d={};return d[this.pathForType(b.typeKey)]=[a.serializerFor(b.typeKey).serialize(c,{includeId:!0})],this.ajax(this.buildURL(b.typeKey),"POST",{data:d})},updateRecord:function(b,c,d){var e={};e[this.pathForType(c.typeKey)]=[b.serializerFor(c.typeKey).serialize(d)];var f=a(d,"id");return this.ajax(this.buildURL(c.typeKey,f),"PUT",{data:e})}})}.call(this);